<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Draggable Grid Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f9f9f9;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 120px);
            grid-template-rows: repeat(3, 120px);
            gap: 10px;
            margin-bottom: 15px;
        }

        .grid-cell {
            background: #e0e0e0;

            border-radius: 5%;
            position: relative;
        }

        .grid-item {
            background-color: #4CAF50;
            color: white;
            padding: 0;
            border-radius: 5%;
            cursor: move;
            user-select: none;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .grid-cell.drag-over {
            color: #2196F3;
            background-color: #cce4ff;
        }

        button {
            margin-right: 10px;
        }

        .delete-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #f44336;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5%;
            width: 20px;
            height: 20px;
            line-height: 15px;
            padding: 0;
            display: none;
        }

        .grid-item:hover .delete-btn {
            display: block;
        }
    </style>
</head>

<body>

    <h2>Draggable Grid Example (Create, Delete, Drag & Drop)</h2>

    <div>
        <button id="add-item-btn">Add Item</button>

    </div>

    <div class="grid-container" id="grid">
        <!-- Grid cells go here -->
    </div>

    <script>
        const grid = document.getElementById('grid');
        const addItemBtn = document.getElementById('add-item-btn');

        // Initialize 12 cells in a 4x3 grid

        function createCell(idx) {
            const cell = document.createElement('div');
            cell.className = 'grid-cell';
            cell.dataset.index = idx;
            cell.addEventListener('dragover', dragOverHandler);
            cell.addEventListener('drop', dropHandler);
            cell.addEventListener('dragenter', dragEnterHandler);
            cell.addEventListener('dragleave', dragLeaveHandler);
            grid.appendChild(cell);
        }

        function populateGrid(rows, cols) {
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `repeat(${cols}, 120px)`;
            grid.style.gridTemplateRows = `repeat(${rows}, 120px)`;
            for (let i = 0; i < rows * cols; i++) {
                createCell(i);
            }
        }

        let draggedItem = null;

        function createGridItem(text) {
            const item = document.createElement('div');
            item.className = 'grid-item';
            item.textContent = text;
            item.draggable = true;

            // Delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = '×';
            deleteBtn.className = 'delete-btn';
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const cell = item.parentElement;
                cell.removeChild(item);
            });
            item.appendChild(deleteBtn);

            // Drag handlers
            item.addEventListener('dragstart', dragStartHandler);
            item.addEventListener('dragend', dragEndHandler);
            return item;
        }

        // Add initial items to some cells
        function populateItems(count) {
            for (let i = 0; i < count; i++) {
                const cell = grid.children[i];
                const item = createGridItem(`Item ${i + 1}`);
                cell.appendChild(item);
            }
        }


        // Initialization
        populateGrid(5, 5)
        populateItems(4)




        addItemBtn.addEventListener('click', () => {
            // Find first empty cell
            let targetCell = null;
            for (const cell of grid.children) {
                if (cell.children.length === 0) {
                    targetCell = cell;
                    break;
                }
            }
            if (targetCell) {
                const newItemNumber = grid.querySelectorAll('.grid-item').length + 1;
                const newItem = createGridItem(`Item ${newItemNumber}`);
                targetCell.appendChild(newItem);
            } else {
                alert('No empty cells available to add new item.');
            }
        });

        function dragStartHandler(e) {
            draggedItem = this;
            // Add some opacity effect when dragging
            setTimeout(() => {
                this.style.display = 'none';
            }, 0);
        }

        function dragEndHandler(e) {
            draggedItem = null;
            this.style.display = 'flex';
            removeDragOverStyles();
        }

        function dragOverHandler(e) {
            e.preventDefault();
        }

        function dropHandler(e) {
            e.preventDefault();
            if (!draggedItem) return;
            if (this === draggedItem.parentElement) {
                // Dropped back where it came from — do nothing special
                return;
            }

            if (this.children.length === 0) {
                // If target cell is empty, just move dragged item there
                this.appendChild(draggedItem);
            } else {
                // Target cell occupied — swap draggedItem with existing item
                const targetItem = this.children[0];
                const draggedParent = draggedItem.parentElement;

                // Swap the two items by moving them to each other’s parent cells
                draggedParent.appendChild(targetItem);
                this.appendChild(draggedItem);
            }

            removeDragOverStyles();
        }


        function dragEnterHandler(e) {
            if (this !== draggedItem.parentElement) {
                this.classList.add('drag-over');
            }
        }

        function dragLeaveHandler(e) {
            this.classList.remove('drag-over');
        }

        function removeDragOverStyles() {
            grid.querySelectorAll('.drag-over').forEach(cell => cell.classList.remove('drag-over'));
        }
    </script>

</body>

</html>