<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Adaptive Grid Groups — Max 3 Columns</title>
<style>
body { font-family: sans-serif; background: #f8f9fb; margin: 0;}
h2 { margin: 20px 0 0 24px; }
#parent-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* Max 3 columns */
  gap: 16px;
  padding: 32px;
}
.child-grid {
  background: #fff;
  border: 2px solid #666;
  border-radius: 8px;
  min-width: 180px;
  min-height: 80px;
  box-shadow: 0 2px 6px #0001;
  padding: 16px 10px 16px 16px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  position: relative;
  transition: box-shadow .16s, border-color .16s;
}
.child-grid.dragover {
  border-color: #2196F3;
  box-shadow: 0 0 0 3px #cce7ff;
}
.grid-item {
  background: #59c96e;
  color: white;
  border-radius: 6px;
  min-width: 70px;
  min-height: 37px;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  position: relative;
  cursor: move;
  user-select: none;
  font-weight: bold;
}
.delete-btn {
  display: none;
  position: absolute;
  top: 3px; right: 7px;
  background: #e53e3e;
  border: none;
  color: #fff; font-weight:bold;
  border-radius: 50%;
  width: 18px; height: 18px; cursor:pointer; font-size:16px; line-height:15px; padding:0;
}
.grid-item:hover .delete-btn { display: block; }

#drop-indicator {
  position: fixed;
  pointer-events: none;
  z-index: 90;
  background: #2196F3cc;
  color: #fff;
  border-radius: 8px;
  font-weight: bold;
  padding: 10px 24px;
  font-size: 18px;
  box-shadow: 0 4px 28px #2196F366;
  display: none;
}
#outside-overlay {
  display: none;
  position: fixed;
  z-index: 80;
  left: 0; top: 0; width: 100vw; height: 100vh;
  background: rgba(33,150,243,0.08);
  pointer-events: none;
}
#outside-overlay.active {
  display: block;
  pointer-events: all;
}
</style>
</head>
<body>
<h2>Adaptive Board: Creating new groups with max 3 columns layout</h2>
<button style="margin:14px 0 0 26px;" onclick="addDemoItem()">Add Random Item to First Group</button>
<div id="parent-grid"></div>
<div id="outside-overlay"></div>
<div id="drop-indicator">Drop here to create a new group</div>
<script>
const parentGrid = document.getElementById('parent-grid');
const dropIndicator = document.getElementById('drop-indicator');
const outsideOverlay = document.getElementById('outside-overlay');
let draggedItem = null;
let draggedText = null;

let groupData = [
  ["Alpha", "Beta"],
  ["Gamma", "Delta", "Epsilon"],
  ["Zeta"],
];

function createGroup(items = [], idx) {
  const group = document.createElement('div');
  group.className = 'child-grid';
  group.dataset.group = idx;

  group.addEventListener('dragover', e => { e.preventDefault(); group.classList.add("dragover"); });
  group.addEventListener('dragleave', e => { group.classList.remove("dragover"); });
  group.addEventListener('drop', function(e) {
    e.preventDefault(); group.classList.remove("dragover");
    if (draggedItem && draggedText) {
      removeFromGroupData(draggedText);
      groupData[idx].push(draggedText);
      renderBoard();
    }
    hideDropIndicator();
    deactivateOutsideOverlay();
  });
  for(const txt of items) group.appendChild(createGridItem(txt));
  return group;
}

function createGridItem(text){
  const item = document.createElement('div');
  item.className = 'grid-item';
  item.textContent = text;
  item.draggable = true;

  const btn = document.createElement('button');
  btn.className = 'delete-btn'; btn.textContent = '×';
  btn.onclick = e => { e.stopPropagation(); removeFromGroupData(text); renderBoard(); };
  item.appendChild(btn);

  item.addEventListener('dragstart', e=>{
    draggedItem = item;
    draggedText = text;
    setTimeout(()=>{ item.style.display='none'; },0);
    document.addEventListener('dragover', onDragAnywhere);
  });
  item.addEventListener('dragend', e=>{
    draggedItem = null;
    draggedText = null;
    item.style.display = '';
    hideDropIndicator();
    deactivateOutsideOverlay();
    document.removeEventListener('dragover', onDragAnywhere);
  });
  return item;
}

function removeFromGroupData(text) {
  for (const g of groupData) {
    const i = g.indexOf(text);
    if (i !== -1) { g.splice(i,1); break; }
  }
}

function onDragAnywhere(ev) {
  const grids = Array.from(document.elementsFromPoint(ev.clientX, ev.clientY))
    .filter(e=>e.classList && e.classList.contains("child-grid"));
  if (grids.length===0 && draggedItem) {
    showDropIndicator(ev.clientX, ev.clientY);
    activateOutsideOverlay();
  } else {
    hideDropIndicator();
    deactivateOutsideOverlay();
  }
}

function showDropIndicator(x, y){
  dropIndicator.style.display = "block";
  dropIndicator.style.left = (x+14) + "px";
  dropIndicator.style.top = (y-28) + "px";
}
function hideDropIndicator(){
  dropIndicator.style.display = "none";
}
function activateOutsideOverlay(){
  outsideOverlay.classList.add("active");
}
function deactivateOutsideOverlay(){
  outsideOverlay.classList.remove("active");
}

outsideOverlay.addEventListener('dragenter', e => { e.preventDefault(); });
outsideOverlay.addEventListener('dragover', e => { e.preventDefault(); });
outsideOverlay.addEventListener('drop', function(ev){
  ev.preventDefault();
  if (!draggedItem || !draggedText) return;
  removeFromGroupData(draggedText);
  groupData.push([draggedText]);
  renderBoard();
  hideDropIndicator();
  deactivateOutsideOverlay();
});

function renderBoard() {
  parentGrid.innerHTML = "";
  groupData = groupData.filter(g=>g.length);
  groupData.forEach((items, idx) => parentGrid.appendChild(createGroup(items, idx)));
}

window.addDemoItem = function(){
  if (groupData.length === 0) groupData.push([]);
  groupData[0].push('Random'+Math.floor(Math.random()*90+10));
  renderBoard();
};
renderBoard();
</script>
</body>
</html>
